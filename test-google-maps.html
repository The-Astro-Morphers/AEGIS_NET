<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Maps API Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        input { padding: 10px; width: 70%; margin-right: 10px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; cursor: pointer; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        .results { margin-top: 20px; }
        .result { padding: 10px; border: 1px solid #ddd; margin: 5px 0; cursor: pointer; }
        .result:hover { background: #f5f5f5; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Google Maps API Test</h1>
        
        <div id="status" class="status info">
            Checking Google Maps API status...
        </div>

        <div>
            <h3>Test Location Search</h3>
            <input type="text" id="searchInput" placeholder="Enter address (e.g., Times Square, New York)" />
            <button id="searchBtn" onclick="searchLocation()" disabled>Search</button>
        </div>

        <div id="results" class="results"></div>

        <div>
            <h3>Test Instructions:</h3>
            <ol>
                <li>Wait for "Google Maps API loaded successfully" status</li>
                <li>Type any address (e.g., "Times Square, New York")</li>
                <li>Click Search button</li>
                <li>You should see real Google Places results</li>
            </ol>
        </div>
    </div>

    <script>
        const API_KEY = 'AIzaSyASqpZk2BdGg2cJ-nKWfuMcC33HofX01w4';
        let googleMapsLoaded = false;

        // Load Google Maps API
        function loadGoogleMaps() {
            const script = document.createElement('script');
            script.src = `https://maps.googleapis.com/maps/api/js?key=${API_KEY}&libraries=places&callback=initGoogleMaps`;
            script.async = true;
            script.defer = true;
            document.head.appendChild(script);
        }

        // Callback when Google Maps loads
        function initGoogleMaps() {
            googleMapsLoaded = true;
            document.getElementById('status').innerHTML = '<div class="success">✅ Google Maps API loaded successfully!</div>';
            document.getElementById('searchBtn').disabled = false;
            console.log('Google Maps API loaded successfully');
        }

        // Search function
        function searchLocation() {
            const query = document.getElementById('searchInput').value;
            const resultsDiv = document.getElementById('results');
            
            if (!query.trim()) {
                alert('Please enter a search term');
                return;
            }

            if (!googleMapsLoaded) {
                alert('Google Maps API not loaded yet. Please wait.');
                return;
            }

            console.log('Searching for:', query);
            
            const service = new google.maps.places.PlacesService(document.createElement('div'));
            const request = {
                query: query,
                fields: ['name', 'formatted_address', 'geometry', 'place_id']
            };

            service.textSearch(request, (results, status) => {
                if (status === google.maps.places.PlacesServiceStatus.OK && results) {
                    console.log('Google Places API results:', results.length, 'results found');
                    displayResults(results);
                } else {
                    console.error('Google Places API error:', status);
                    resultsDiv.innerHTML = `<div class="error">Error: ${status}</div>`;
                }
            });
        }

        // Display results
        function displayResults(results) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';

            if (results.length === 0) {
                resultsDiv.innerHTML = '<div class="info">No results found</div>';
                return;
            }

            results.forEach((place, index) => {
                const resultDiv = document.createElement('div');
                resultDiv.className = 'result';
                resultDiv.innerHTML = `
                    <strong>${place.name || place.formatted_address}</strong><br>
                    <small>${place.formatted_address || place.name}</small><br>
                    <small>Coordinates: ${place.geometry?.location?.lat()?.toFixed(6)}, ${place.geometry?.location?.lng()?.toFixed(6)}</small>
                `;
                resultDiv.onclick = () => selectLocation(place);
                resultsDiv.appendChild(resultDiv);
            });
        }

        // Select location
        function selectLocation(place) {
            alert(`Selected: ${place.name || place.formatted_address}`);
            console.log('Selected location:', place);
        }

        // Enable/disable search button based on input
        document.getElementById('searchInput').addEventListener('input', function() {
            const searchBtn = document.getElementById('searchBtn');
            searchBtn.disabled = !this.value.trim() || !googleMapsLoaded;
        });

        // Allow Enter key to search
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !searchBtn.disabled) {
                searchLocation();
            }
        });

        // Start loading Google Maps API
        loadGoogleMaps();

        // Fallback timeout
        setTimeout(() => {
            if (!googleMapsLoaded) {
                document.getElementById('status').innerHTML = '<div class="error">❌ Google Maps API failed to load. Check your API key and internet connection.</div>';
            }
        }, 10000);
    </script>
</body>
</html>
